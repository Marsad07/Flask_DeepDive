{% extends "base.html" %}

{% block title %}{{ subject.name }}{% endblock %}

{% block content %}
<div class="subject-header">
    <h1>{{ subject.name }}</h1>
</div>

<h2>Active Tasks</h2>

{% if tasks %}
<table>
    <tr>
        <th>Task</th>
        <th>Priority</th>
        <th>Due Date</th>
        <th>Edit</th>
        <th>Complete</th>
    </tr>

    {% for task in tasks if task.status == 'active' %}
    <tr>
        <td>{{ task.task_name }}</td>
        <td>{{ task.priority }}</td>
        <td>{{ task.due_date }}</td>
        <td>
            <a href="/edit_task/{{ task.id }}">
                <span class="edit-icon">‚úèÔ∏è</span>
            </a>
        </td>
        <td>
            <form action="/subjects/{{ subject.id }}/complete_task" method="POST">
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <button type="submit" style="background:none;border:none;cursor:pointer;">‚úî</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No tasks added for {{ subject.name }} yet.</p>
{% endif %}

<h2>Completed Tasks</h2>

<table>
    <tr>
        <th>Task</th>
        <th>Priority</th>
        <th>Completed</th>
        <th>Delete</th>
    </tr>

    {% for task in tasks if task.status == 'completed' %}
    <tr>
        <td>{{ task.task_name }}</td>
        <td>{{ task.priority }}</td>
        <td>‚úî</td>
        <td>
            <form action="/subjects/{{ subject.id }}/delete_task" method="POST">
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <button type="submit" style="background:none;border:none;cursor:pointer;">üóëÔ∏è</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<h2>Progression</h2>

<div class="progress-circle" style="--value: {{ progress }};">
  <div class="inner">{{ progress }}%</div>
</div>

<div class="progress-breakdown">
  <div class="metric">
    ‚úî Tasks completed: {{ completed_pct }}%
  </div>
  <div class="metric">
    ‚≠ê Priority progress: {{ weighted_pct }}%
  </div>
  <div class="metric">
    üéØ Study goal progress: {{ goal_pct }}%
  </div>
</div>

<button onclick="toggleDetails()" class="details-btn">Full Details</button>

<div id="details-panel" style="display:none;">
  <p>High priority tasks left: {{ high_left }}</p>
  <p>Study goal target: {{ study_goal }}</p>
  <p>Suggested next task: {{ next_task }}</p>
</div>
<style>
.progress-circle {
    --size: 120px;
    --thickness: 12px;
    --value: 0;
    width: var(--size);
    height: var(--size);
    border-radius: 50%;
    background: conic-gradient(
        #4caf50 calc(var(--value) * 1%),
        #ddd 0
    );
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto;
    position: relative;
}

.progress-circle .inner {
    width: calc(var(--size) - var(--thickness) * 2);
    height: calc(var(--size) - var(--thickness) * 2);
    border-radius: 50%;
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    font-weight: bold;
}

.details-btn {
    margin-top: 10px;
    padding: 8px 16px;
    border: none;
    background: #eee;
    border-radius: 6px;
    cursor: pointer;
}
</style>
<script>
function toggleDetails() {
    const box = document.getElementById("details-panel");
    box.style.display = box.style.display === "none" ? "block" : "none";
}
</script>
{% endblock %}

